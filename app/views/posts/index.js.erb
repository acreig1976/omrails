$boxes = $('<%= j render(@posts) %>')

$('#posts').append( $boxes ).imagesLoaded( function(){
  $('#posts').masonry( 'reload');
});
<% if @posts.next_page %>
  $('.pagination').replaceWith('<%= j will_paginate(@posts) %>');
<% else %>
  $('.pagination').remove();
<% end %>